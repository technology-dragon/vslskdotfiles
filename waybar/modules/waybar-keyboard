#!/bin/sh
# waybar-keyboard — для Hyprland
# i.technology_devil — 2025

# Получаем текущую раскладку через hyprctl
layout=$(hyprctl devices -j | jq -r '
  .keyboards[] | 
  select(.name != "AT Translated Set 2 keyboard") | 
  .active_keymap // "??"
' 2>/dev/null | head -n1)

# Fallback
[ "$layout" = "null" ] && layout="??"

# Nerd-символы для раскладок (под твой вкус)
case "$layout" in
  "English (US)"|us|US)  icon="" ;;   #  = keyboard
  "Russian")             icon="РУ" ;;   # или "" (russian flag), но текст чётче
  "ru")                  icon="РУ" ;;
  "de")                  icon="" ;;   # german flag
  *)                     icon="" ;;
esac

# Вывод в формате Waybar — JSON
printf '{"text": "%s %s", "tooltip": "Layout: %s", "class": "layout-%s"}\n' \
  "$icon" "$layout" "$layout" "$(echo "$layout" | tr '[:upper:]' '[:lower:]')"
